# Модель загроз платформи "БукМаркет"

## 1. Вступ

Цей документ містить модель загроз для платформи обміну та продажу вживаних книг "БукМаркет". Аналіз включає ідентифікацію загроз у ключових потоках платформи та план пом'якшення для найбільш критичних загроз.

## 2. Методологія

Для аналізу загроз використовувався підхід STRIDE:
- **S**poofing (Підміна)
- **T**ampering (Втручання)
- **R**epudiation (Відмова)
- **I**nformation Disclosure (Розкриття інформації)
- **D**enial of Service (Відмова в обслуговуванні)
- **E**levation of Privilege (Підвищення привілеїв)

Оцінка ризиків проводилась за шкалою:
- **Критичний**: Потребує негайного вирішення
- **Високий**: Потребує вирішення до запуску продукту
- **Середній**: Потребує вирішення в найближчих версіях
- **Низький**: Може бути відкладено на майбутні версії

## 3. Моделювання загроз основних потоків

### 3.1. Потік: Реєстрація та аутентифікація користувачів

#### Опис потоку
1. Користувач вводить особисті дані (email, пароль)
2. Система перевіряє унікальність email
3. Система надсилає верифікаційний лист
4. Користувач підтверджує email
5. Система створює обліковий запис
6. Користувач може авторизуватись у системі

#### Діаграма потоку

```
+-------------+          +-------------+          +----------------+
|             |  Дані    |             |  Запит   |                |
| Користувач  +--------->|  Веб-сервер +--------->|  База даних    |
|             |          |             |          |                |
+-------------+          +------+------+          +----------------+
                                |
                                | Верифікаційний
                                | лист
                                v
                         +------+------+
                         |  Поштовий   |
                         |  сервер     |
                         |             |
                         +-------------+
```

#### Ідентифіковані загрози

| ID | Тип (STRIDE) | Опис загрози | Ризик | Вектор атаки |
|----|-------------|-------------|-------|-------------|
| T1 | S, I | Брутфорс атаки на облікові записи | Високий | Автоматизований підбір паролів |
| T2 | I, D | Відмова в обслуговуванні через масову реєстрацію | Середній | Автоматизоване створення фейкових облікових записів |
| T3 | S | Підміна верифікаційного посилання | Середній | Перехоплення або підробка верифікаційного листа |
| T4 | I | Витік даних користувача | Критичний | Незашифроване зберігання персональних даних |
| T5 | T | Ін'єкція шкідливого коду через поля реєстрації | Високий | XSS, SQL-ін'єкції через вхідні дані |
| T6 | S | Зламування слабких парольних політик | Високий | Використання словників, соціальна інженерія |
| T7 | I | Перехоплення даних при реєстрації | Високий | MITM-атаки при відсутності шифрування |

### 3.2. Потік: Транзакції та оплата

#### Опис потоку
1. Покупець вибирає книгу для придбання
2. Покупець вводить платіжні дані
3. Система обробляє платіж через платіжні системи
4. Система утримує оплату до підтвердження отримання
5. Покупець отримує книгу і підтверджує отримання
6. Продавець отримує кошти

#### Діаграма потоку

```
+-------------+          +--------------+         +------------------+
|             | Платіжні |              | Запит   |                  |
|  Покупець   +---------> "БукМаркет"   +-------->| Платіжні системи |
|             |  дані    |              |         |                  |
+-------------+          +-+------------+         +---------+--------+
                           |                                |
                           | Обробка                        | Підтвердження
                           v                                v
+-------------+          +-+------------+         +---------+--------+
|             | Товар    |              | Кошти   |                  |
|  Продавець  <----------+ Депонування  <---------+  Банк покупця    |
|             |          |              |         |                  |
+-------------+          +--------------+         +------------------+
```

#### Ідентифіковані загрози

| ID | Тип (STRIDE) | Опис загрози | Ризик | Вектор атаки |
|----|-------------|-------------|-------|-------------|
| T8 | I | Перехоплення платіжних даних | Критичний | MITM-атаки, кейлогери, фішинг |
| T9 | T | Маніпуляція з ціною або деталями транзакції | Високий | Підміна параметрів запиту |
| T10 | R | Відмова від здійснення транзакції | Середній | Недостатнє логування та аудит дій |
| T11 | T, I | Підміна платіжних систем | Критичний | DNS-спуфінг, фішинг |
| T12 | D | DoS атака на платіжну систему | Високий | Велика кількість фейкових транзакцій |
| T13 | S | Використання вкрадених платіжних даних | Високий | Крадіжка номерів карток, даних авторизації |
| T14 | I | Витік історії транзакцій користувача | Високий | Недостатня ізоляція даних, інсайдерські загрози |

## 4. План пом'якшення критичних загроз

### План для 10 найкритичніших загроз

| ID | Загроза | План пом'якшення |
|----|--------|-----------------|
| T4 | Витік даних користувача | 1. Шифрування всіх персональних даних у базі даних<br>2. Впровадження принципу мінімізації даних<br>3. Регулярний аудит безпеки<br>4. Впровадження монітирингу аномального доступу до даних |
| T8 | Перехоплення платіжних даних | 1. Використання PCI DSS сертифікованих платіжних систем<br>2. Відмова від зберігання платіжних даних на серверах<br>3. Використання токенізації для платіжних операцій<br>4. Обов'язкове TLS 1.3 шифрування |
| T11 | Підміна платіжних систем | 1. Впровадження HSTS<br>2. Використання сертифікатів EV SSL<br>3. Впровадження Certificate Pinning<br>4. Використання мультифакторної автентифікації для транзакцій |
| T5 | Ін'єкція шкідливого коду | 1. Використання ORM для запитів до БД<br>2. Валідація всіх вхідних даних<br>3. Впровадження Content Security Policy<br>4. Використання parameterized queries |
| T7 | Перехоплення даних при реєстрації | 1. Використання TLS для всіх з'єднань<br>2. Впровадження HSTS<br>3. Моніторинг сертифікатів для виявлення підозрілих видач |
| T1 | Брутфорс атаки | 1. Обмеження кількості спроб входу<br>2. Впровадження CAPTCHA<br>3. Використання затримок при невдалих спробах<br>4. Сповіщення про підозрілі спроби входу |
| T6 | Зламування слабких парольних політик | 1. Впровадження вимог до складності паролів<br>2. Перевірка паролів проти баз скомпрометованих паролів<br>3. Заохочення використання парольних менеджерів<br>4. Реалізація двофакторної автентифікації |
| T9 | Маніпуляція з деталями транзакції | 1. Перевірка цілісності параметрів на сервері<br>2. Криптографічне підписання платіжних даних<br>3. Багаторівнева валідація транзакцій<br>4. Використання ідемпотентних API |
| T13 | Використання вкрадених платіжних даних | 1. Впровадження аналізу поведінки для виявлення аномалій<br>2. Використання Address Verification Service (AVS)<br>3. Використання 3D Secure протоколу<br>4. Впровадження геолокаційної перевірки |
| T14 | Витік історії транзакцій | 1. Шифрування історії транзакцій<br>2. Розділення даних користувача і транзакцій<br>3. Контроль доступу на основі ролей<br>4. Детальне логування доступу до транзакційних даних |

## 5. Заходи безпеки по категоріях

### 5.1. Аутентифікація та авторизація
- Впровадження строгих парольних політик
- Обов'язкове двофакторне аутентифікація (2FA) для критичних операцій
- Використання JWT з коротким терміном дії
- Впровадження контролю доступу на основі ролей (RBAC)
- Заборона повторного використання паролів

### 5.2. Захист даних
- Шифрування даних у спокої (at rest) та в русі (in transit)
- Впровадження політики мінімізації даних
- Анонімізація або псевдонімізація даних для аналітики
- Регулярний аудит доступу до даних
- Автоматизовані сповіщення про підозрілу активність

### 5.3. Безпека веб-додатків
- Використання актуального OWASP Top 10 для розробки
- Регулярне сканування вразливостей
- Впровадження Web Application Firewall (WAF)
- Захист від XSS через Content Security Policy
- Захист від CSRF через одноразові токени

### 5.4. Моніторинг та реагування
- Впровадження SIEM для централізованого логування
- Моніторинг аномальної активності користувачів
- Розробка плану реагування на інциденти
- Проведення регулярних тренувань з реагування на інциденти
- Автоматизовані сповіщення про підозрілу активність

### 5.5. Безпека третіх сторін
- Ретельний аудит API інтеграцій
- Регулярна перевірка безпеки зовнішніх сервісів
- Обмеження доступу для сторонніх сервісів
- Використання API ключів з мінімально необхідними правами
- Впровадження Rate Limiting для API

## 6. Висновок

Запропонована модель загроз визначає ключові вразливості у двох основних потоках платформи "БукМаркет". План пом'якшення загроз забезпечує основу для впровадження заходів безпеки на етапах проектування, розробки та експлуатації системи.

Для забезпечення довготривалої безпеки рекомендується:
1. Регулярно оновлювати модель загроз при зміні функціоналу системи
2. Проводити проникаючі тестування перед випуском нових версій
3. Впровадити програму Bug Bounty для залучення зовнішніх дослідників
4. Забезпечити постійне навчання з питань безпеки для команди розробки
5. Проводити регулярний аудит конфігурацій безпеки та коду системи 